<div class="flex flex-col h-screen items-center">
  <h1 class="py-10 font-extrabold text-5xl text-center">
    Apartments Marketplace
  </h1>

  <div class="flex w-full justify-center gap-4">
    <div class="w-[20%]">
      <form (ngSubmit)="onFormSubmit()" [formGroup]="apartmentsForm" class="px-4">
        <div class="mt-2">
          <label for="name" class="font-bold">Name</label>
          <input type="text" class="w-full p-2 border-2 rounded-sm mt-2" formControlName="name" />
          @if (apartmentsForm.controls.name.invalid && (apartmentsForm.controls.name.dirty || apartmentsForm.controls.name.touched)) {
          @if (apartmentsForm.controls.name.errors?.['required']){
          <div class="text-red-500">
            Name is required.
          </div>
          }
          @if (apartmentsForm.controls.name.errors?.['maxlength']){
          <div class="text-red-500">
            Lenght should be less than 100 characters.
          </div>
          }
          }
        </div>

        <div class="mt-2">
          <label for="rooms" class="font-bold">Rooms</label>
          <input type="number" class="w-full p-2 border-2 rounded-sm mt-2" formControlName="rooms" />
          @if (apartmentsForm.controls.rooms.invalid && (apartmentsForm.controls.rooms.dirty || apartmentsForm.controls.rooms.touched)) {
          @if (apartmentsForm.controls.rooms.errors?.['required']){
          <div class="text-red-500">
            Number of rooms is required.
          </div>
          }
          @if (apartmentsForm.controls.rooms.errors?.['min']){
          <div class="text-red-500">
            Minimum value is 1.
          </div>
          }
          }
        </div>

        <div class="mt-2">
          <label for="description" class="font-bold">Description</label>
          <textarea  type="text" class="w-full p-2 border-2 rounded-sm mt-2" formControlName="description"></textarea>
          @if (apartmentsForm.controls.description.invalid && (apartmentsForm.controls.description.dirty || apartmentsForm.controls.description.touched)) {
          @if (apartmentsForm.controls.description.errors?.['maxlength']){
          <div class="text-red-500">
            Lenght should be less than 1000 characters.
          </div>
          }
          }
        </div>

        <div class="mt-2">
          <label for="price" class="font-bold">Price</label>
          <input type="number" class="w-full p-2 border-2 rounded-sm mt-2" formControlName="price" />
          @if (apartmentsForm.controls.price.invalid && (apartmentsForm.controls.price.dirty || apartmentsForm.controls.price.touched)) {
          @if (apartmentsForm.controls.price.errors?.['required']){
          <div class="text-red-500">
            Price is required.
          </div>
          }
          @if (apartmentsForm.controls.price.errors?.['min']){
          <div class="text-red-500">
            Minimum value is 1.
          </div>
          }
          }
        </div>

        <div class="mt-2">
          <button type="submit" class="bg-slate-800 text-white px-4 py-2 rounded-sm w-full">Add</button>
        </div>
      </form>
    </div>

    <div class="w-[40%] overflow-auto">
      @if (apartments$ | async; as apartments) {
      @if (apartments.length > 0) {
      <div class="flex flex-row items-center justify-center gap-4">
        <h2 class="basis-1/3"><b>AVAILABLE APARTMENTS: {{ sortedApartments.length }}</b></h2>

        <div class="basis-1/4 flex w-full justify-center items-center mb-4 gap-4">
          <label for="filter" class="font-bold">Filter:</label>
          <select id="filter" (change)="onFilterChange($event)" class="w-[50%] p-2 border-2 rounded-sm mt-2">
            <option value="default">-</option>
            <option value="1">1 room</option>
            <option value="2">2 rooms</option>
            <option value="3">3 rooms</option>
            <option value="4">4 rooms</option>
            <option value="5">5 rooms</option>
          </select>
        </div>

        <div class="basis-1/3 flex w-full justify-center items-center mb-4 gap-4">
          <label for="sort" class="font-bold">Sort:</label>
          <select id="sort" (change)="onSortChange($event)" class="w-full p-2 border-2 rounded-sm mt-2">
            <option value="default">-</option>
            <option value="price-asc">Price - lowest to highest</option>
            <option value="price-desc">Price - highest to lowest</option>
          </select>
        </div>
      </div>

      <ul>
        @for (item of sortedApartments; track $index) {
        <li class="p-2 bg-slate-100 border-b-2 border-slate-200">
          <span class="font-light text-3xl">
            {{ item.name }}
          </span>
          <div class="flex items-center justify-between items-center mt-4 w-full gap-4">
            <div>
              <span class="flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                  <path stroke-linecap="round" stroke-linejoin="round" d="m2.25 12 8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25" />
                </svg>
                <span class="ms-2">Number of rooms: <b>{{ item.rooms }}</b></span>
              </span>
              <span class="flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09ZM18.259 8.715 18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 0 0 2.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 0 0-2.456 2.456ZM16.894 20.567 16.5 21.75l-.394-1.183a2.25 2.25 0 0 0-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 0 0 1.423-1.423l.394-1.183.394 1.183a2.25 2.25 0 0 0 1.423 1.423l1.183.394-1.183.394a2.25 2.25 0 0 0-1.423 1.423Z" />
                </svg>
                <span class="ms-2">{{ item.description }}</span>
              </span>
              <span class="flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v12m-3-2.818.879.659c1.171.879 3.07.879 4.242 0 1.172-.879 1.172-2.303 0-3.182C13.536 12.219 12.768 12 12 12c-.725 0-1.45-.22-2.003-.659-1.106-.879-1.106-2.303 0-3.182s2.9-.879 4.006 0l.415.33M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
                </svg>
                <span class="ms-2">Price: <b>${{ item.price }}</b></span>
              </span>
            </div>
            <button (click)="onDelete(item.id)" class="bg-slate-50 text-dark py-2 px-4 rounded-sm" type="button">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6 text-red-600">
                <path stroke-linecap="round" stroke-linejoin="round" d="m20.25 7.5-.625 10.632a2.25 2.25 0 0 1-2.247 2.118H6.622a2.25 2.25 0 0 1-2.247-2.118L3.75 7.5m6 4.125 2.25 2.25m0 0 2.25 2.25M12 13.875l2.25-2.25M12 13.875l-2.25 2.25M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125Z" />
              </svg>
            </button>
          </div>
        </li>
        }
      </ul>
      } @else {
      <p>No apartments found.</p>
      }
      }
    </div>
  </div>
</div>
